#include<stdio.h>
#include<unistd.h>
#include<stdlib.h>

int main(void)
{
     
    char tamponP1[20]="le pere ecrit \n",tamponF1[20]=" le fils ecrit \n";
    char tamponP2[20],tamponF2[20];
    int res,r=0;
    int p1[2],p2[2];

    
    if (pipe(p1)!=0)
    {
        fprintf(stdout," erreur pipe \n");
        exit(1);
    }
    else if(pipe(p2)!=0)
    {
        fprintf(stdout," erreur pipe \n");
        exit(1);
    }
    
    close(p1[0]);
    write(p1[1],tamponP1, 20 );
    res=fork();

    if(res==0)
    {
        
        close(p2[0]); //fermer l'acces en ecriture du tube P2 au processus enfant
        read(p1[0],tamponP2,20);
        write(p2[1],tamponF1,20);
    }
    else
    {
        read(p2[0],tamponF2,20);

    }
    
    printf("le pere lit : %s \n",tamponF2);
    printf("le fils lit : %s \n",tamponP2);

    return 0;
}
